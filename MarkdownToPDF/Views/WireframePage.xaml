<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MarkdownToPDF.Views.WireframePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:MarkdownToPDF.Models"
    mc:Ignorable="d">

    <Page.Resources>
        <Style x:Key="A4PageCard" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#DDD"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="4"/>
            <Setter Property="Margin" Value="16"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="48"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <Grid Grid.Row="0" Background="{ThemeResource LayerFillColorDefaultBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Left: hierarchy toggle -->
            <StackPanel Grid.Column="0"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Left">
                <Button x:Name="HierarchyButton"
                        ToolTipService.ToolTip="Outline"
                        Click="HierarchyButton_Click"
                        Margin="8,0,8,0">
                    <SymbolIcon Symbol="Bookmarks"/>
                </Button>
            </StackPanel>

            <!-- Center: page input -->
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Margin="12,0,0,0"
                        Spacing="6">
                <TextBox x:Name="PageInputBox"
                         Width="56"
                         Text="{Binding CurrentPage, Mode=OneWay}"
                         HorizontalContentAlignment="Center"
                         VerticalContentAlignment="Center"
                         KeyDown="PageInputBox_KeyDown"
                         InputScope="Number"/>
                <TextBlock Text="of"
                           VerticalAlignment="Center"
                           Opacity="0.8"/>
                <TextBlock Text="{Binding TotalPages}"
                           VerticalAlignment="Center"
                           FontWeight="SemiBold"/>
            </StackPanel>

            <!-- Right actions -->
            <StackPanel Grid.Column="2"
                        Orientation="Horizontal"
                        Spacing="4"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Right"
                        Margin="0,0,8,0">
                <Button x:Name="ClearFilesButton"
                        ToolTipService.ToolTip="Clear current files and add new"
                        Click="ClearFiles_Click"
                        Margin="0,0,4,0">
                    <SymbolIcon Symbol="Delete"/>
                </Button>

                <Button x:Name="SettingsButton"
                        ToolTipService.ToolTip="Settings"
                        Click="Settings_Click">
                    <SymbolIcon Symbol="Setting"/>
                </Button>
            </StackPanel>
        </Grid>

        <!-- Content with left hierarchy pane -->
        <SplitView x:Name="HierarchySplitView"
                   Grid.Row="1"
                   DisplayMode="Overlay"
                   OpenPaneLength="350"
                   CompactPaneLength="0"
                   IsPaneOpen="False"
                   PanePlacement="Left">
            <SplitView.Pane>
                <Grid Background="{ThemeResource ControlFillColorSecondaryBrush}">
                    <TreeView x:Name="HierarchyTree"
                              ItemInvoked="HierarchyTree_ItemInvoked">
                        <TreeView.ItemContainerStyle>
                            <Style TargetType="TreeViewItem">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            </Style>
                        </TreeView.ItemContainerStyle>
                        <TreeView.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Content.Text}"
                                           TextWrapping="Wrap"
                                           TextTrimming="None"
                                           VerticalAlignment="Center"/>
                            </DataTemplate>
                        </TreeView.ItemTemplate>
                    </TreeView>
                </Grid>
            </SplitView.Pane>

            <SplitView.Content>
                <Grid>
                    <StackPanel x:Name="CenterStatusPanel"
                               HorizontalAlignment="Center"
                               VerticalAlignment="Center"
                               Visibility="Collapsed"
                               Spacing="12">
                        <TextBlock x:Name="ContentTextBlock"
                                   FontSize="18"
                                   TextWrapping="Wrap"
                                   TextAlignment="Center"/>
                        <ProgressBar x:Name="CenterProgressBar"
                                     Width="130"
                                     IsIndeterminate="True"
                                     ShowPaused="False"
                                     ShowError="False"
                                     Visibility="Collapsed"/>
                    </StackPanel>
                    
                    <ScrollViewer x:Name="PreviewScrollViewer"
                                  ViewChanged="PreviewScrollViewer_ViewChanged"
                                  HorizontalScrollBarVisibility="Disabled"
                                  VerticalScrollBarVisibility="Auto">
                        <ItemsControl x:Name="PagesItemsControl"
                                      ItemsSource="{Binding PreviewPages}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical"
                                                HorizontalAlignment="Center"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Style="{StaticResource A4PageCard}"
                                            Width="{Binding DataContext.PagePreviewWidthPx, ElementName=PagesItemsControl}"
                                            Height="{Binding DataContext.PagePreviewHeightPx, ElementName=PagesItemsControl}">
                                        <Image Source="{Binding}" Stretch="UniformToFill"/>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <Button x:Name="AddFilesInitialButton"
                            Click="AddFilesInitialButton_Click"
                            ToolTipService.ToolTip="Add files"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Margin="0,0,20,20"
                            Style="{StaticResource AccentButtonStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <SymbolIcon Symbol="Add"/>
                            <TextBlock Text="Add Files"/>
                        </StackPanel>
                    </Button>

                    <Button x:Name="ExportButton"
                            Click="ExportPdf_Click"
                            ToolTipService.ToolTip="Save / Export PDF"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Bottom"
                            Margin="0,0,20,20"
                            Style="{StaticResource AccentButtonStyle}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE74E;" />
                            <TextBlock Text="Save PDF"/>
                        </StackPanel>
                    </Button>

                    <!-- Scroll to top button - appears when scrolled down -->
                    <Button x:Name="ScrollToTopButton"
                            Click="ScrollToTopButton_Click"
                            Visibility="Collapsed"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Bottom"
                            Margin="0,0,0,20"
                            Padding="0"
                            Width="32"
                            Height="32"
                            CornerRadius="16"
                            Style="{StaticResource AccentButtonStyle}" 
                            Foreground="#c0000000"
                            Background="#c0f5f5f5">
                        <FontIcon Glyph="&#xE70E;" />
                    </Button>
                </Grid>
            </SplitView.Content>
        </SplitView>
    </Grid>
</Page>
